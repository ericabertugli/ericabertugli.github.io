<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Inline Skating - Erica Bertugli</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet.fullscreen@3.0.2/Control.FullScreen.css"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: #000000;
        color: #ffffff;
        font-family: "Inter", sans-serif;
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        padding: 40px 20px;
      }

      .container {
        max-width: 800px;
        width: 100%;
        text-align: center;
      }

      h1 {
        font-size: 2.5rem;
        font-weight: 300;
        margin-bottom: 30px;
        letter-spacing: 2px;
      }

      .icon {
        width: 64px;
        height: 64px;
        margin-bottom: 20px;
      }

      p {
        font-size: 1.2rem;
        color: #888888;
        margin-bottom: 40px;
      }

      .back-link {
        color: #ffffff;
        text-decoration: none;
        font-size: 1rem;
        padding: 12px 24px;
        border: 1px solid #ffffff;
        border-radius: 4px;
        transition: all 0.3s ease;
        letter-spacing: 1px;
        display: inline-block;
      }

      .back-link:hover {
        background-color: #ffffff;
        color: #000000;
      }

      .disclaimer {
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 16px 20px;
        margin-bottom: 24px;
        font-size: 0.85rem;
        color: #999;
        text-align: left;
        line-height: 1.5;
      }

      .disclaimer-title {
        color: #ccc;
        font-weight: 500;
        margin-bottom: 8px;
      }

      #map {
        width: 100%;
        height: 400px;
        border-radius: 4px;
        margin-bottom: 30px;
      }

      .map-legend {
        background: white;
        color: #333;
        padding: 8px 12px;
        border-radius: 4px;
        box-shadow: 0 1px 5px rgba(0, 0, 0, 0.3);
        font-size: 12px;
        line-height: 1.6;
      }

      .map-legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        padding: 4px 6px;
        margin: -4px -6px;
        border-radius: 4px;
        transition: background-color 0.2s;
      }

      .map-legend-item:hover {
        background-color: #f0f0f0;
      }

      .map-legend-item.disabled {
        opacity: 0.4;
      }

      .map-legend-line {
        width: 24px;
        height: 3px;
        border-radius: 2px;
      }

      .map-legend-line.cycleways {
        background: #22c55e;
      }

      .map-legend-line.pedestrian-ways {
        background: #a855f7;
      }

      .map-legend-line.slow-traffic {
        background: #38bdf8;
      }

      .map-legend-line.no-skating {
        background: #ef4444;
        position: relative;
      }

      .map-legend-line.no-skating::after {
        content: "✕";
        position: absolute;
        top: -7px;
        left: 50%;
        transform: translateX(-50%);
        color: #ef4444;
        font-size: 10px;
        font-weight: bold;
      }

      .map-legend-line.frequent-routes {
        background: #1e40af;
      }

      .other-places {
        text-align: left;
        margin-top: 60px;
        margin-bottom: 40px;
        padding-top: 40px;
        border-top: 1px solid #333;
      }

      .other-places h2 {
        font-size: 1.4rem;
        font-weight: 400;
        margin-bottom: 20px;
        color: #ffffff;
      }

      .route-card {
        background-color: #1a1a1a;
        border: 1px solid #333;
        border-radius: 4px;
        padding: 20px;
        margin-bottom: 20px;
      }

      .route-card h3 {
        font-size: 1.1rem;
        font-weight: 500;
        margin-bottom: 16px;
        color: #ffffff;
      }

      .route-embeds {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
      }

      .route-part {
        flex: 1;
        min-width: 280px;
      }

      .route-part-label {
        font-size: 0.9rem;
        color: #888888;
        margin-bottom: 8px;
      }

      .route-part iframe {
        border-radius: 4px;
        border: none;
        width: 100%;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <img
        class="icon"
        src="icons/inline-skating-svgrepo-com.svg"
        alt="Inline skating icon"
      />
      <h1>Inline Skating</h1>
      <p>Barcelona skating routes</p>

      <div class="disclaimer">
        <div class="disclaimer-title">Disclaimer</div>
        This map combines data from OpenStreetMap with personal observations I
        collected while skating. I am not responsible for the accuracy of the
        information displayed, nor for the legality of skating along the routes
        shown. Please use this map at your own risk.
      </div>

      <div id="map"></div>

      <div class="other-places">
        <h2>Other skating routes</h2>
        <div class="route-card">
          <h3>From València to Castelló de la Plana</h3>
          <div class="route-embeds">
            <div class="route-part">
              <div class="route-part-label">Part 1</div>
              <iframe
                src="https://www.wikiloc.com/wikiloc/spatialArtifacts.do?event=view&id=215260659&measures=off&title=off&maptype=S"
                width="100%"
                height="250"
                loading="lazy"
                title="Valencia to Xilxes route map"
              ></iframe>
            </div>
            <div class="route-part">
              <div class="route-part-label">Part 2</div>
              <iframe
                src="https://www.wikiloc.com/wikiloc/spatialArtifacts.do?event=view&id=215350898&measures=off&title=off&maptype=S"
                width="100%"
                height="250"
                loading="lazy"
                title="Xilxes to Castello route map"
              ></iframe>
            </div>
          </div>
        </div>
      </div>

      <a href="index.html" class="back-link">← Back Home</a>
    </div>

    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
    <script src="https://unpkg.com/leaflet-polylinedecorator@1.6.0/dist/leaflet.polylineDecorator.js"></script>
    <script src="https://unpkg.com/leaflet.fullscreen@3.0.2/Control.FullScreen.js"></script>
    <script>
      const map = L.map("map", {
        fullscreenControl: true,
      }).setView([41.3874, 2.1686], 13);

      L.tileLayer(
        "https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",
        {
          maxZoom: 19,
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/">CARTO</a>',
        },
      ).addTo(map);

      const layerGroups = {
        frequent_routes: L.layerGroup().addTo(map),
        cycleways: L.layerGroup(),
        pedestrian_ways: L.layerGroup(),
        "30kmh_ways": L.layerGroup(),
        no_skating: L.layerGroup(),
      };
      const layerVisibility = {
        frequent_routes: true,
        cycleways: false,
        pedestrian_ways: false,
        "30kmh_ways": false,
        no_skating: false,
      };

      const legend = L.control({ position: "bottomright" });
      legend.onAdd = function () {
        const div = L.DomUtil.create("div", "map-legend");
        div.innerHTML = `
          <div class="map-legend-item" data-layer="frequent_routes">
            <span class="map-legend-line frequent-routes"></span>
            <span>My frequent routes</span>
          </div>
          <div class="map-legend-item disabled" data-layer="cycleways">
            <span class="map-legend-line cycleways"></span>
            <span>Bike lanes (source: OSM)</span>
          </div>
          <div class="map-legend-item disabled" data-layer="pedestrian_ways">
            <span class="map-legend-line pedestrian-ways"></span>
            <span>Pedestrian ways (source: OSM)</span>
          </div>
          <div class="map-legend-item disabled" data-layer="30kmh_ways">
            <span class="map-legend-line slow-traffic"></span>
            <span>30 km/h streets (source: OSM)</span>
          </div>
          <div class="map-legend-item disabled" data-layer="no_skating">
            <span class="map-legend-line no-skating"></span>
            <span>Skating not allowed (source: OSM)</span>
          </div>
        `;
        div.querySelectorAll(".map-legend-item").forEach((item) => {
          item.addEventListener("click", (e) => {
            e.stopPropagation();
            const layerType = item.dataset.layer;
            layerVisibility[layerType] = !layerVisibility[layerType];
            item.classList.toggle("disabled", !layerVisibility[layerType]);
            if (layerVisibility[layerType]) {
              map.addLayer(layerGroups[layerType]);
            } else {
              map.removeLayer(layerGroups[layerType]);
            }
          });
        });
        L.DomEvent.disableClickPropagation(div);
        return div;
      };
      legend.addTo(map);

      fetch("data/routes.geojson")
        .then((response) => {
          if (!response.ok) {
            throw new Error(`HTTP error: ${response.status}`);
          }
          return response.json();
        })
        .then((data) => {
          const wayTypeStyles = {
            cycleways: { color: "#22c55e", weight: 1, opacity: 0.8 },
            pedestrian_ways: { color: "#a855f7", weight: 1, opacity: 0.8 },
            "30kmh_ways": { color: "#38bdf8", weight: 1, opacity: 0.8 },
            no_skating: { color: "#ef4444", weight: 1, opacity: 0.8 },
          };
          const defaultStyle = { color: "#888888", weight: 3, opacity: 0.8 };

          const noSkatingLayers = [];

          L.geoJSON(data, {
            style: (feature) =>
              wayTypeStyles[feature.properties.way_type] || defaultStyle,
            onEachFeature: (feature, layer) => {
              const props = feature.properties;
              const name = props.name || "Unnamed path";
              const surface = props.tags?.surface || "unknown";
              const smoothness = props.tags?.smoothness || "unknown";
              const wayType = props.way_type;
              const noSkating = wayType === "no_skating";
              const warning = noSkating
                ? '<br><strong style="color:#ef4444;">Skating not allowed</strong>'
                : "";
              layer.bindPopup(
                `<strong>${name}</strong><br>Surface: ${surface}<br>Smoothness: ${smoothness}${warning}`,
              );
              if (layerGroups[wayType]) {
                layerGroups[wayType].addLayer(layer);
              }
              if (noSkating) {
                noSkatingLayers.push(layer);
              }
            },
          });

          noSkatingLayers.forEach((layer) => {
            const decorator = L.polylineDecorator(layer, {
              patterns: [
                {
                  offset: 12,
                  repeat: 24,
                  symbol: L.Symbol.marker({
                    rotate: true,
                    markerOptions: {
                      icon: L.divIcon({
                        className: "",
                        html: '<span style="color:#ef4444;font-weight:bold;font-size:12px;">✕</span>',
                        iconSize: [12, 12],
                        iconAnchor: [6, 6],
                      }),
                    },
                  }),
                },
              ],
            });
            layerGroups.no_skating.addLayer(decorator);
          });
        })
        .catch((error) => {
          console.error("Failed to load skating routes:", error);
          document.getElementById("map").innerHTML =
            '<div style="display:flex;align-items:center;justify-content:center;height:100%;color:#616161;">Unable to load routes. Please try again later.</div>';
        });

      fetch("data/frequent_routes.geojson")
        .then((response) => response.json())
        .then((data) => {
          L.geoJSON(data, {
            style: {
              fillColor: "#1e40af",
              fillOpacity: 0.7,
              weight: 0,
            },
            onEachFeature: (feature, layer) => {
              layerGroups.frequent_routes.addLayer(layer);
            },
          });
        })
        .catch((error) => {
          console.error("Failed to load frequent routes:", error);
        });

      const drinkingWaterIcon = L.divIcon({
        html: '<span style="font-size:6px;color:#7cb9e8;">●</span>',
        className: "",
        iconSize: [8, 8],
        iconAnchor: [3, 3],
      });

      fetch("data/drinking_water.geojson")
        .then((response) => response.json())
        .then((data) => {
          L.geoJSON(data, {
            pointToLayer: (feature, latlng) =>
              L.marker(latlng, { icon: drinkingWaterIcon }),
            onEachFeature: (feature, layer) => {
              layer.bindPopup("Drinking water");
            },
          }).addTo(map);
        })
        .catch((error) => {
          console.error("Failed to load drinking water locations:", error);
        });
    </script>
  </body>
</html>
